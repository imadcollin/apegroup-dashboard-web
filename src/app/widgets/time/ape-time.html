<link rel="import" href="../../../assets/libs/polymer/polymer.html">

<dom-module id="ape-time">

    <template>

        <style>

            :host {
                position: relative;
                display: flex;
                width: 100%;
                height: 100%;
                flex-direction: column;
                padding: 1.6rem;
                justify-content: center;
                align-items: center;
                font-size: 7rem;
                font-weight: 700;
            }

        </style>

        <div>[[_time]]</div>

    </template>

    <script>

        Polymer({

            is: `ape-time`,

            properties: {
                size: {
                    type: String,
                    observer: `_observerSize`,
                    // reflectToAttribute: true
                },
                _time: {
                    type: String,
                },
                _timeoutId: {
                    type: Number
                }
            },

            /* Life cycle */

            activate() {
                const today = new Date();
                const hour = today.getHours();
                const minutes = today.getMinutes();
                const hourFormatted = this._addZeroIfSingleDigit(hour);
                const minutesFormatted = this._addZeroIfSingleDigit(minutes);
                this._time =  `${hourFormatted}:${minutesFormatted}`;
                this._timeoutId = setTimeout(this.activate.bind(this), 1000);
            },

            deactivate() {
                clearTimeout(this._timeoutId);
            },

            /* Observers */

            _observerSize(size) {
                if (size.width < 1 || size.height < 1) {
                    this.deactivate();
                    this.fire(`widget-message`, {
                        message: `Denna widget kräver en yta på minst 6x6`
                    });
                } else {
                    this.activate();
                    this.fire(`widget-message`, {
                        message: null
                    });
                }
            },

            /**
             * Add a zero in front of the string if it is a single digit.
             * Return formatted digit as string.
             */
            _addZeroIfSingleDigit(digit) {
                const digitString = digit.toString();
                return (digitString.length === 1) ? `0${digit}` : `${digit}`;
            }

        });

    </script>

</dom-module>